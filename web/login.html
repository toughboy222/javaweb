<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>220162401030 史程昊</title> <style>
  * {
    margin: 0; /* */
    padding: 0; /* */
    box-sizing: border-box; /* */
  }

  body {
    font-family: 'PingFang SC', 'Helvetica Neue', sans-serif; /* */
    background: url('https://img1.baidu.com/it/u=3948018914,231270887&fm=253&fmt=auto&app=138&f=JPEG?w=750&h=500') center/cover fixed; /* */
    min-height: 100vh; /* */
    display: flex; /* */
    justify-content: center; /* */
    align-items: center; /* */
    padding: 20px; /* */
  }

  .login-container {
    background: rgba(255, 255, 255, 0.98); /* */
    width: 100%; /* */
    max-width: 420px; /* */
    padding: 40px 30px; /* */
    border-radius: 16px; /* */
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08); /* */
    position: relative; /* */
  }

  .login-title {
    color: #333; /* */
    font-size: 28px; /* */
    line-height: 1.6; /* */
    margin-bottom: 32px; /* */
    position: relative; /* */
  }
  .login-title::after {
    content: ''; /* */
    position: absolute; /* */
    bottom: -6px; /* */
    left: 0; /* */
    width: 100%; /* */
    height: 2px; /* */
    background: #eee; /* */
  }

  .input-group {
    display: flex; /* */
    align-items: center; /* */
    margin-bottom: 24px; /* */
    position: relative; /* */
  }
  .input-group input {
    flex: 1; /* */
    padding: 14px; /* */
    border: 2px solid #ddd; /* */
    border-radius: 8px; /* */
    font-size: 16px; /* */
    transition: border-color 0.3s ease; /* */
  }
  .input-group input:focus {
    outline: none; /* */
    border-color: #007bff; /* */
    box-shadow: 0 0 8px rgba(0, 123, 255, 0.2); /* */
  }

  .btn-container {
    display: flex; /* */
    justify-content: space-between; /* */
    gap: 15px; /* */
    margin-top: 20px; /* */
  }

  .main-login-btn {
    background: #007bff; /* */
    color: white; /* */
    padding: 16px 32px; /* */
    border: none; /* */
    border-radius: 8px; /* */
    cursor: pointer; /* */
    font-size: 16px; /* */
    flex: 1; /* */
    transition: transform 0.1s ease; /* */
  }

  .register-btn {
    background: #f0f2f5; /* */
    color: #007bff; /* */
    padding: 16px 32px; /* */
    border: none; /* */
    border-radius: 8px; /* */
    cursor: pointer; /* */
    font-size: 16px; /* */
    flex: 1; /* */
    transition: all 0.3s ease; /* */
  }
  .register-btn:hover {
    background: #e6f0ff; /* */
  }

  .forgot-password {
    text-align: right; /* */
    margin: -10px 0 15px; /* */
  }
  .forgot-password a {
    color: #666; /* */
    font-size: 14px; /* */
    text-decoration: none; /* */
    transition: color 0.3s ease; /* */
  }
  .forgot-password a:hover {
    color: #007bff; /* */
  }

  .qr-code-section {
    margin-top: 32px; /* */
    text-align: center; /* */
  }
  .qr-code-img {
    width: 120px; /* */
    height: 120px; /* */
    margin: 20px auto; /* */
    border-radius: 8px; /* */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* */
  }
  .qr-code-text {
    color: #666; /* */
    font-size: 14px; /* */
    line-height: 1.8; /* */
    margin-top: 16px; /* */
  }
  .qr-code-text span {
    color: #007bff; /* */
    font-weight: bold; /* */
  }

  .other-logins {
    margin-top: 32px; /* */
    text-align: center; /* */
  }
  .other-logins-title {
    color: #999; /* */
    font-size: 14px; /* */
    margin-bottom: 24px; /* */
  }
  .login-icons {
    display: flex; /* */
    justify-content: center; /* */
    gap: 24px; /* */
    margin-top: 16px; /* */
  }
  .login-icons img {
    width: 40px; /* */
    height: 40px; /* */
    cursor: pointer; /* */
    transition: transform 0.2s ease; /* */
  }
  .login-icons img:hover {
    transform: scale(1.1); /* */
  }

  .footer {
    margin-top: 40px; /* */
    color: #999; /* */
    font-size: 12px; /* */
    line-height: 1.6; /* */
    text-align: center; /* */
  }
  .footer a {
    color: #007bff; /* */
    text-decoration: none; /* */
    font-weight: bold; /* */
  }
  .footer a:hover {
    text-decoration: underline; /* */
  }
</style>
</head>
<body>
<div class="login-container">
  <h1 class="login-title">登录掘金畅享更多权益</h1> <div class="input-group">
  <input type="tel" id="username" name="username" placeholder="请输入手机号" required pattern="1[3-9]\d{9}"
         title="请输入有效的中国大陆手机号">
</div>

  <div class="input-group">
    <input type="password" id="password" name="password" placeholder="请输入密码" required> </div>

  <div class="forgot-password">
    <a href="#" onclick="handleForgotPassword()">忘记密码？</a> </div>

  <div class="btn-container">
    <button class="main-login-btn" onclick="return handleLogin()">登录</button> <button class="register-btn" onclick="window.location.href='register.html'">立即注册</button> </div>

  <div class="qr-code-section">
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEX///8AAABVwtN+AAAFUUlEQVR42uydPbLjOAyE4VKgUEfQUXQ0+Wg+io6gUIHK2EI3SP34vZ1kgzWnGUyVOXyfExb+2IBNS0tLS0tLS+v/uSbH2nrf7eFu7s/5Nb1sXON/sfs2HHnZuJgNPP8WoDHAK/4dtvzoZrO/bIqja+++d3Hc/Dk/47uWPPkQQIA7YHRfY7vbeedw0hdeub3zd1zQ2Z8TruKwBVaAVgH9bh2O2gzj46tZH4ff9sBF8tfky7gKIMAfAN3+wOV72vRKh+f17By+Da5NgEYB9ExxkTxDnDBIeZPMQLWZu/a7axPguwEl1N3pmYyh7rgMcbu22KRBecbmuP4eKwvwVwPKCkBJmuIzb2IcxVVMz/QvObQAXw0IizTE9Yig1nCRMrfB/TKGukh5zEYGwPvdpAkgAFzbsIbtYZpsM7Ijmim4trf5EeqGu+s+ijACfD0AcUvcmL3Dbnim3AWAQQ49U+z2EQ09BGgMEGeHNT1T/D3Kr+GYhrg0HbMblGrhr8LIWOcCCHAHhJnJomwEtdVd+Zp7xSLZUb59CNAaICPdksc4yyUZtvhu5XY9J2bU/S8ZjwACxMmtK+W3yJ0j1F35WgjPhkrthJr/Vs2UAC0BJtTdjoc9GqQx0mQU55Nq82sqr8b73TMJ8PUA5jFD5DG4Hs7tkTfJuv2BjLjELWlQBBDgo6Y6ZizTpRdCzrSUs8crD3JnXyN3vpo0ARoATG4eschWAXFlIg9ypDzl1dfmAoATE0CAK4AxDoyPZzHO8coTm336O09lW4ZD+0fOJMC3A6BlHDLUfWdxHoXaMD5Zd8tnntGXIS6SCdAcgPWxtd+KPjE9ExBb74hQMgAe6Zn6jwhFAAHworMi1M3t+Tk5LVI4oRL3lO/CV3UCtAdIJ0T5AGppEaH4CgnazhJKqaFAwXY3aQIIcAiSnALH1DJGUOtFKfDIxgwbubtdijgCtAE4pEdHIR7K+apHqq884zJC9Xiv6grQAGAKe3IWuiLWTRV0yXaYCC020qDcqroCCHCSD1h28T3DCwUgX3muooLTpgANAaYiReTDXvqgqegTu3PnZ/qrzQRoD8A7A30idWnOlGdgvx48U+3YWygU+GzFEUCA8dp9dXRQWH3Yo/w1PqzsJBegOYAzfvXD30DoysM9ZSTlkYY93/3dMwkgAHUobJVIYdozdSiDb5b1V0+hK3f7a1FXgBYADHFYaqU+MfZSn3gu1fqrNNhsnQDNAUoLRRqUqkvzDGo7vP6ffdhdhyKAAEU5P6y9XzoopnRMWS5J+StFSh+tOAI0AOCEkGp7MCdgqsX57PnO1ryFAfBG2yWAAPcQhyU2TKWhSP5oq8jnvjLlKtsATYDGAEiT/dLJzSa8FWK1qlZjyuOfrXkCNAGgNgSK1OyoyveY1CdaGVkE07MM8EwCCHAHnAJYr8MD6ty82uuLIRIjWrKs3y+uTYAWAJQi0vbkNufepXqgps6Yhcfc+d4sLIAAlm+AWwlxLK2PX96Nj65xiNXuvX0CfD2ANRScpIzkkCLm3DxO16QPw0DWn4pxAnw7IKJaJDJWp9Kc9Im+F8DMFs3UFAggwAcg5+bxXQ8iec5AyzfAYyLrYilw/Hl+ogBfDDh+OiBbsk6Nm4cUsdTSflLOCyDA9acDLpO+UzF9rdDVsp0L0BygTvpObTNj2tGv6w8CRwEaAXBuSA118yU452hm2OJFW/Lrb1AIIEDn55YsFONymB5bcfjMkyJ7AdoDnKYiZgnlqKBAOf8+6dIw7sx+cW0C/M2AI9Td6yDOOk6vKAVOro1lOxOgLYCWlpaWlpaW1n+5/gkAAP//OH3nQzYXoz0AAAAASUVORK5CYII=" alt="扫码登录" class="qr-code-img"> <p class="qr-code-text">
    打开稀土掘金APP <span>(6.4.1及以上版本支持)</span><br> 点击"我-左上角扫一扫"登录
  </p>
  </div>

  <div class="other-logins">
    <p class="other-logins-title">其他登录方式：</p> <div class="login-icons">
    <img src="https://pic.rmb.bdstatic.com/bjh/news/67e1c599723d9d66a47d989d8ecb627a9629.jpeg" alt="Github登录"> <img src="https://img1.baidu.com/it/u=1078970566,1032880499&fm=253&fmt=auto&app=138&f=PNG?w=233&h=234" alt="微博登录"> <img src="https://b0.bdstatic.com/2d5f17ae885bfbc63b9ef5f8467d3dfa.jpg@h_1280" alt="QQ登录"> </div>
  </div>

  <div class="footer">
    注册登录即表示同意<br> <a href="/agreement">用户协议</a> 和 <a href="/privacy">隐私政策</a> </div>
</div>
<script>
  function handleLogin() {
    const usernameInput = document.getElementById('username'); // 使用ID获取元素
    const passwordInput = document.getElementById('password'); // 使用ID获取元素

    const username = usernameInput.value.trim(); //
    const password = passwordInput.value; //

    if (!username) { alert("请输入手机号！"); usernameInput.focus(); return false; } //
    if (!password) { alert("请输入密码！"); passwordInput.focus(); return false; } //
    if (!/^1[3-9]\d{9}$/.test(username)) { alert("请输入有效的中国大陆手机号！"); usernameInput.focus(); return false; } //


    console.log("前端尝试登录 - 用户名:", username, "密码已输入"); //

    const formData = new URLSearchParams(); //
    formData.append("username", username); //
    formData.append("password", password); //

    fetch("LoginServlet", { //
      method: "POST", //
      headers: { "Content-Type": "application/x-www-form-urlencoded" }, //
      body: formData.toString() //
    })
            .then(response => {
              console.log("收到后端响应状态:", response.status); //
              if (!response.ok) { //
                return response.json().then(errData => { //
                  let errorMessage = "登录请求失败"; //
                  if (errData && errData.message) { errorMessage = errData.message; } //
                  else if (errData && errData.error) { errorMessage = errData.error;} //
                  else { errorMessage = `登录请求失败，状态码：${response.status}`; } //
                  throw new Error(errorMessage); //
                }).catch((jsonParseError) => { //
                  console.error("解析后端错误JSON失败:", jsonParseError); //
                  throw new Error(`登录请求失败，服务器返回状态：${response.status}，且响应体非JSON格式或解析错误。`); //
                });
              }
              return response.json(); //
            })
            .then(result => {
              console.log("后端返回结果:", result); //
              if (result.success) { //
                alert(result.message || "登录成功！"); //
                localStorage.setItem('isLoggedIn', 'true'); //
                console.log("localStorage 'isLoggedIn' 已设置为 'true'"); //

                if (result.nickname) { //
                  localStorage.setItem('userNickname', result.nickname); //
                  console.log("localStorage 'userNickname' 已设置为:", result.nickname); //
                } else {
                  localStorage.removeItem('userNickname'); //
                  console.log("后端未返回昵称, localStorage 'userNickname' 已移除或未设置。"); //
                }

                // --- 新增：存储头像URL到localStorage ---
                if (result.avatarUrl) {
                  localStorage.setItem('userAvatarUrl', result.avatarUrl); // 存储相对路径
                  console.log("localStorage 'userAvatarUrl' 已设置为:", result.avatarUrl);
                } else {
                  localStorage.removeItem('userAvatarUrl');
                  console.log("后端未返回头像URL, localStorage 'userAvatarUrl' 已移除或未设置。");
                }
                // --- 结束新增 ---

                const redirectUrlParams = new URLSearchParams(window.location.search); //
                const redirectTarget = redirectUrlParams.get('redirect'); //
                console.log("重定向目标:", redirectTarget); //
                window.location.href = redirectTarget || "main.html"; //

              } else {
                alert(result.message || "登录失败，请检查您的凭据。"); //
              }
            })
            .catch(error => {
              console.error("登录请求或处理失败：", error); //
              alert(error.message || "登录过程中发生网络或未知错误，请稍后重试。"); //
            });
    return false; //
  }

  function handleForgotPassword() {
    alert("忘记密码功能暂未实现。"); //
  }
</script>
</body>
</html>